#!/usr/bin/env node

const config = require('config');
const Sentry = require("@sentry/node");
const db = require('../db/db');
const pollingServer = require('../polling-server/server');

Sentry.init({
    dsn: config.get('sentry.polling'),
    tracesSampleRate: 1.0
});

// Unexpected errors
process.on('unhandledRejection', error => {
    Sentry.captureException(error);
});

db.init()
    .then(() => pollingServer.init())
    .then(() => {
        pollingServer.start();
    })
    .catch(e => {
        Sentry.captureException(e);
    });
